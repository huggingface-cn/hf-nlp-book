## 9.4 é«˜çº§InterfaceåŠŸèƒ½åŠBlocksä»‹ç»

ç°åœ¨æˆ‘ä»¬å¯ä»¥æ„å»ºå’Œå…±äº«ä¸€ä¸ªåŸºæœ¬æ¥å£ï¼Œè®©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€äº›æ›´é«˜çº§çš„ç‰¹æ€§ï¼Œå¦‚çŠ¶æ€å’Œè§£é‡Šï¼ŒåŒæ—¶äº†è§£`gradio.Blocks` ä½çº§ APIã€‚

### ä½¿ç”¨çŠ¶æ€ä¿å­˜æ•°æ® 

Gradio æ”¯æŒ `ä¼šè¯çŠ¶æ€` ï¼Œå…¶ä¸­æ•°æ®åœ¨é¡µé¢åŠ è½½ä¸­çš„å¤šä¸ªæäº¤ä¸­æŒç»­å­˜åœ¨ã€‚ä¼šè¯çŠ¶æ€å¯¹äºæ„å»ºdemoå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œä½ å¸Œæœ›åœ¨ç”¨æˆ·ä¸æ¨¡å‹äº¤äº’æ—¶ä¿ç•™æ•°æ®çš„èŠå¤©æœºå™¨äººã€‚è¯·æ³¨æ„ï¼Œä¼šè¯çŠ¶æ€ä¸ä¼šåœ¨æ¨¡å‹çš„ä¸åŒç”¨æˆ·ä¹‹é—´å…±äº«æ•°æ®ã€‚

è¦å°†æ•°æ®å­˜å‚¨åœ¨ä¼šè¯çŠ¶æ€ä¸­ï¼Œä½ éœ€è¦åšä¸‰ä»¶äº‹ï¼š

1ã€‚å‘å‡½æ•°ä¸­ä¼ é€’ä¸€ä¸ª `é¢å¤–çš„å‚æ•°` , è¯¥å‚æ•°è¡¨ç¤ºæ¥å£çš„çŠ¶æ€ã€‚
1. åœ¨å‡½æ•°ç»“æŸæ—¶ï¼Œå°†çŠ¶æ€çš„æ›´æ–°å€¼ä½œä¸º `é¢å¤–çš„è¿”å›å€¼` è¿”å›ã€‚
1. åœ¨åˆ›å»º `æ¥å£` æ—¶æ·»åŠ  'state' è¾“å…¥å’Œ 'state' è¾“å‡ºç»„ä»¶ã€‚

è¯·å‚é˜…ä¸‹é¢çš„èŠå¤©æœºå™¨äººç¤ºä¾‹ï¼š

```python
import random

import gradio as gr

def chat(message, history):
    history = history or []
    if message.startswith("How many"):
        response = random.randint(1, 10)
    elif message.startswith("How"):
        response = random.choice(["Great", "Good", "Okay", "Bad"])
    elif message.startswith("Where"):
        response = random.choice(["Here", "There", "Somewhere"])
    else:
        response = "I don't know"
    history.append((message, response))
    return history, history

iface = gr.Interface(
    chat,
    ["text", "state"],
    ["chatbot", "state"],
    allow_screenshot=False,
    allow_flagging="never",
)
iface.launch()
```

è¯·æ³¨æ„è¾“å‡ºç»„ä»¶çš„çŠ¶æ€å¦‚ä½•åœ¨æäº¤ä¹‹é—´ä¿æŒä¸å˜ã€‚æ³¨æ„ï¼šå¯ä»¥ç»™ state å‚æ•°ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½œä¸º state çš„åˆå§‹å€¼ã€‚

#### é€šè¿‡è§£é‡Šæ¥ç†è§£é¢„æµ‹ 

å¤§å¤šæ•°æœºå™¨å­¦ä¹ æ¨¡å‹éƒ½æ˜¯é»‘ç›’å­ï¼Œå‡½æ•°çš„å†…éƒ¨é€»è¾‘å¯¹ç»ˆç«¯ç”¨æˆ·æ˜¯éšè—çš„ã€‚ä¸ºäº†æé«˜é€æ˜åº¦ï¼Œæˆ‘ä»¬é€šè¿‡ç®€å•åœ°å°† Interface ç±»ä¸­çš„è§£é‡Šå…³é”®å­—è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œä½¿å‘æ¨¡å‹æ·»åŠ è§£é‡Šå˜å¾—éå¸¸å®¹æ˜“ã€‚è¿™å…è®¸ä½ çš„ç”¨æˆ·ç†è§£è¾“å…¥çš„å“ªäº›éƒ¨åˆ†è´Ÿè´£è¾“å‡ºã€‚çœ‹çœ‹ä¸‹é¢è¿™ä¸ªç®€å•çš„æ¥å£ï¼Œå®ƒæ˜¾ç¤ºäº†ä¸€ä¸ªè¿˜åŒ…æ‹¬è§£é‡Šçš„å›¾åƒåˆ†ç±»å™¨ï¼š

```python
import requests
import tensorflow as tf

import gradio as gr

inception_net = tf.keras.applications.MobileNetV2()  # load the model

## ä¸‹è½½ ImageNet çš„å¯è¯»æ ‡ç­¾
response = requests.get("https://git.io/JJkYN")
labels = response.text.split("\n")

def classify_image(inp):
    inp = inp.reshape((-1, 224, 224, 3))
    inp = tf.keras.applications.mobilenet_v2.preprocess_input(inp)
    prediction = inception_net.predict(inp).flatten()
    return {labels[i]: float(prediction[i]) for i in range(1000)}

image = gr.Image(shape=(224, 224))
label = gr.Label(num_top_classes=3)

title = "Gradio Image Classifiction + Interpretation Example"
gr.Interface(
    fn=classify_image, inputs=image, outputs=label, interpretation="default", title=title
).launch()
```

é€šè¿‡æäº¤ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åå•å‡»è¾“å‡ºç»„ä»¶ä¸‹çš„ Interpret æ¥æµ‹è¯•è§£é‡ŠåŠŸèƒ½ã€‚

é™¤äº† Gradio æä¾›çš„é»˜è®¤è§£é‡Šæ–¹æ³•ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä¸º `interpretation` å‚æ•°æŒ‡å®š `shap` ï¼Œå¹¶è®¾ç½® `num_shap` å‚æ•°ã€‚è¿™ä½¿ç”¨åŸºäº Shapley çš„è§£é‡Šï¼Œä½ å¯ä»¥åœ¨ [here](https://christophm.github.io/interpretable-ml-book/shap.html)(https://christophm.github.io/interpretable-ml-book/shap.html) é˜…è¯»æ›´å¤šä¿¡æ¯ã€‚æœ€åï¼Œè¿˜å¯ä»¥å°†è‡ªå·±çš„è§£é‡Šå‡½æ•°ä¼ å…¥ `interpretation` å‚æ•°ã€‚åœ¨ Gradio çš„å…¥é—¨é¡µé¢ [here](https://gradio.app/getting_started/)(https://gradio.app/getting_started/) ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¾‹å­ã€‚

è¿™ç»“æŸäº†æˆ‘ä»¬å¯¹ Gradio çš„ `Interface` ç±»çš„æ·±å…¥ç ”ç©¶ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ä¸ªç±»ä½¿ç”¨å‡ è¡Œ Python ä»£ç åˆ›å»ºæœºå™¨å­¦ä¹ demoå˜å¾—ç®€å•ã€‚ç„¶è€Œï¼Œæœ‰æ—¶ä½ ä¼šæƒ³é€šè¿‡æ”¹å˜å¸ƒå±€æˆ–é“¾æ¥å¤šä¸ªé¢„æµ‹å‡½æ•°æ¥å®šåˆ¶ä½ çš„ demoã€‚å¦‚æœæˆ‘ä»¬èƒ½ä»¥æŸç§æ–¹å¼å°† `æ¥å£` åˆ†æˆå¯å®šåˆ¶çš„ "å—"ï¼Œé‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œæœ‰ï¼è¿™æ˜¯æœ€åä¸€éƒ¨åˆ†çš„ä¸»é¢˜ã€‚

### Blockså—

åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨ `Interface` ç±»æ¢ç´¢å¹¶åˆ›å»ºäº†demoã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»æˆ‘ä»¬ **æ–°å¼€å‘**çš„ç§°ä¸º `gradio.Blocks` ä½çº§ APIã€‚

ç°åœ¨ï¼Œ `æ¥å£` å’Œ `å—` ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

- âš¡ `æ¥å£` ï¼šä¸€ä¸ªé«˜çº§ APIï¼Œè®©ä½ åªéœ€æä¾›è¾“å…¥å’Œè¾“å‡ºåˆ—è¡¨å³å¯åˆ›å»ºå®Œæ•´çš„æœºå™¨å­¦ä¹ demoã€‚

- ğŸ§± `å—` ï¼šä¸€ä¸ªä½çº§çš„ APIï¼Œå®ƒå…è®¸ä½ å®Œå…¨æ§åˆ¶ä½ çš„åº”ç”¨ç¨‹åºçš„æ•°æ®æµå’Œå¸ƒå±€ã€‚ä½ å¯ä»¥ä½¿ç”¨ `å—` ï¼ˆå¦‚ "æ„å»ºå—"ï¼‰æ„å»ºéå¸¸å¤æ‚çš„å¤šæ­¥éª¤åº”ç”¨ç¨‹åºã€‚

#### ä¸ºä»€ä¹ˆè¦å— ğŸ§±ï¼Ÿ

æ­£å¦‚æˆ‘ä»¬åœ¨å‰å‡ èŠ‚ä¸­çœ‹åˆ°çš„ï¼Œ `Interface` ç±»å…è®¸ä½ ä½¿ç”¨å‡ è¡Œä»£ç è½»æ¾åˆ›å»ºæˆç†Ÿçš„æœºå™¨å­¦ä¹  demoã€‚ `Interface` API éå¸¸æ˜“äºä½¿ç”¨ï¼Œä½†ç¼ºä¹ `Blocks` API æä¾›çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ï¼š

- å°†ç›¸å…³demoç»„åˆä¸ºä¸€ä¸ª web åº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªé€‰é¡¹å¡
- æ›´æ”¹ demo çš„å¸ƒå±€ï¼Œä¾‹å¦‚æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºçš„ä½ç½®
- å…·æœ‰å¤šæ­¥éª¤æ¥å£ï¼Œå…¶ä¸­ä¸€ä¸ªæ¨¡å‹çš„è¾“å‡ºæˆä¸ºä¸‹ä¸€ä¸ªæ¨¡å‹çš„è¾“å…¥ï¼Œæˆ–è€…é€šå¸¸å…·æœ‰æ›´çµæ´»çš„æ•°æ®æµ
- æ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ”¹ç»„ä»¶çš„å±æ€§ ï¼ˆä¾‹å¦‚ï¼Œä¸‹æ‹‰åˆ—è¡¨ä¸­çš„é€‰é¡¹ï¼‰ æˆ–å…¶å¯è§æ€§

æˆ‘ä»¬å°†åœ¨ä¸‹é¢æ¢è®¨æ‰€æœ‰è¿™äº›æ¦‚å¿µã€‚

#### ä½¿ç”¨å—åˆ›å»ºç®€å• demo 

å®‰è£… Gradio åï¼Œå°†ä»¥ä¸‹ä»£ç ä½œä¸º Python è„šæœ¬ã€Jupyter ç¬”è®°æœ¬æˆ– Colab ç¬”è®°æœ¬è¿è¡Œã€‚

```python
import gradio as gr

def flip_text(x):
    return x[::-1]

demo = gr.Blocks()

with demo:
    gr.Markdown(
        """
    # Flip Text!
    Start typing below to see the output.
    """
    )
    input = gr.Textbox(placeholder="Flip this text")
    output = gr.Textbox()

    input.change(fn=flip_text, inputs=input, outputs=output)

demo.launch()
```

ä¸Šè¿°ç®€å•ç¤ºä¾‹ä»‹ç»äº†å—çš„ 4 ä¸ªåŸºæœ¬æ¦‚å¿µï¼š

1. å—å…è®¸ä½ å…è®¸ä½ æ„å»ºç»“åˆ markdownã€HTMLã€æŒ‰é’®å’Œäº¤äº’ç»„ä»¶çš„ web åº”ç”¨ç¨‹åºï¼Œåªéœ€åœ¨ä¸€ä¸ªå¸¦æœ‰ gradio çš„ Python ä¸­å®ä¾‹åŒ–å¯¹è±¡ã€‚
<div custom-style="Tip-green">

ğŸ™‹å¦‚æœä½ ä¸ç†Ÿæ‚‰ Python ä¸­çš„ `with` è¯­å¥ï¼Œæˆ‘ä»¬å»ºè®®ä½ æŸ¥çœ‹æ¥è‡ª Real Python çš„æå¥½çš„ [æ•™ç¨‹](https://realpython.com/python-with-statement)(https://realpython.com/python-with-statement) ã€‚çœ‹å®Œåå›åˆ°è¿™é‡Œ 
</div>
å®ä¾‹åŒ–ç»„ä»¶çš„é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ éƒ½æŒ‰ç…§åˆ›å»ºçš„é¡ºåºå‘ˆç°åˆ° Web åº”ç”¨ç¨‹åºä¸­ã€‚ï¼ˆæ›´å¤æ‚çš„å¸ƒå±€åœ¨ä¸‹é¢è®¨è®ºï¼‰

2. ä½ å¯ä»¥åœ¨ä»£ç ä¸­çš„ä»»ä½•ä½ç½®å®šä¹‰å¸¸è§„ Python å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ `å—` åœ¨ç”¨æˆ·è¾“å…¥çš„æƒ…å†µä¸‹è¿è¡Œå®ƒä»¬ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œä»¬æœ‰ä¸€ä¸ª"ç¿»è½¬"è¾“å…¥æ–‡æœ¬çš„ç®€å•å‡½æ•°ï¼Œä½†ä½ å¯ä»¥ç¼–å†™ä»»ä½• Python å‡½æ•°ï¼Œä»ç®€å•çš„è®¡ç®—åˆ°å¤„ç†æœºå™¨å­¦ä¹ æ¨¡å‹çš„é¢„æµ‹ã€‚

3. ä½ å¯ä»¥å°†äº‹ä»¶æŒ‡å®šç»™ä»»ä½• `å—` ç»„ä»¶ã€‚è¿™å°†åœ¨ç»„ä»¶è¢«å•å‡»ã€æ›´æ”¹ç­‰æƒ…å†µä¸‹è¿è¡Œå‡½æ•°ã€‚å½“ä½ åˆ†é…ä¸€ä¸ªäº‹ä»¶æ—¶ï¼Œä½ ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š `fn` ï¼šåº”è¯¥è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œ `inputs` ï¼šè¾“å…¥ç»„ä»¶çš„ï¼ˆåˆ—è¡¨ï¼‰ï¼Œä»¥åŠ `outputs` ï¼šåº”è¯¥è¢«è°ƒç”¨çš„è¾“å‡ºç»„ä»¶çš„ï¼ˆåˆ—è¡¨ï¼‰ã€‚

   åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå½“åä¸º `input` çš„ `Textbox` ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬è¿è¡Œ `flip_text()` å‡½æ•°ã€‚è¯¥äº‹ä»¶è¯»å– `è¾“å…¥` ä¸­çš„å€¼ï¼Œå°†å…¶ä½œä¸ºåç§°å‚æ•°ä¼ é€’ç»™ `flip_text()` ï¼Œç„¶åå®ƒè¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼è¢«åˆ†é…ç»™æˆ‘ä»¬çš„ç¬¬äºŒä¸ªåä¸º `output` çš„ `Textbox` ã€‚

   è¦æŸ¥çœ‹æ¯ä¸ªç»„ä»¶æ”¯æŒçš„äº‹ä»¶åˆ—è¡¨ï¼Œè¯·å‚é˜… Gradio [æ–‡æ¡£](https://www.gradio.app/docs)(https://www.gradio.app/docs) ã€‚

4. å—ä¼šæ ¹æ®ä½ å®šä¹‰çš„äº‹ä»¶è§¦å‘å™¨è‡ªåŠ¨ç¡®å®šç»„ä»¶æ˜¯å¦åº”è¯¥æ˜¯äº¤äº’å¼çš„ ï¼ˆæ¥å—ç”¨æˆ·è¾“å…¥ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ªæ–‡æœ¬æ¡†æ˜¯äº¤äº’å¼çš„ï¼Œå› ä¸ºå®ƒçš„å€¼ç”± `flip_text()` å‡½æ•°ä½¿ç”¨ã€‚ç¬¬äºŒä¸ªæ–‡æœ¬æ¡†ä¸æ˜¯äº¤äº’å¼çš„ï¼Œå› ä¸ºå®ƒçš„å€¼ä»ä¸ç”¨ä½œè¾“å…¥ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦è¦†ç›–å®ƒï¼Œä½ å¯ä»¥é€šè¿‡ä¼ é€’ä¸€ä¸ªå¸ƒå°”å€¼ç»™ç»„ä»¶çš„ `äº¤äº’` å‚æ•°ï¼ˆä¾‹å¦‚ `gr.Textbox(placeholder="Flip this text", interactive=True)` ï¼‰ã€‚

#### è‡ªå®šä¹‰demoçš„å¸ƒå±€ 

æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ `å—` æ¥å®šåˆ¶æˆ‘ä»¬çš„demoçš„å¸ƒå±€ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œ `å—` åœ¨ä¸€åˆ—ä¸­å‚ç›´å‘ˆç°åˆ›å»ºçš„ç»„ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `with gradio.Column():` åˆ›å»ºå…¶ä»–åˆ—æˆ–ä½¿ç”¨ `with gradio.Row():` åˆ›å»ºå…¶ä»–è¡Œå¹¶åœ¨è¿™äº›ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºç»„ä»¶æ¥æ”¹å˜è¿™ä¸€ç‚¹ã€‚

ä½ åº”è¯¥è®°ä½ï¼šåœ¨ `åˆ—` ä¸‹åˆ›å»ºçš„ä»»ä½•ç»„ä»¶ï¼ˆè¿™ä¹Ÿæ˜¯é»˜è®¤è®¾ç½®ï¼‰ éƒ½å°†å‚ç›´å¸ƒå±€ã€‚åœ¨ `Row` ä¸‹åˆ›å»ºçš„ä»»ä½•ç»„ä»¶éƒ½å°†æ°´å¹³å¸ƒå±€ï¼Œç±»ä¼¼äº [Web å¼€å‘ä¸­çš„ flexbox æ¨¡å‹](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox)(https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox) ã€‚

æœ€åï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ `with gradio.Tabs()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸ºä½ çš„ demo åˆ›å»ºé€‰é¡¹å¡ã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `gradio.TabItem(name_of_tab):` æŒ‡å®šæ¥åˆ›å»ºå¤šä¸ªé€‰é¡¹å¡ã€‚åœ¨ `gradio.TabItem(name_of_tab):` ä¸­åˆ›å»ºçš„ä»»ä½•ç»„ä»¶éƒ½ä¼šå‡ºç°åœ¨è¯¥é€‰é¡¹å¡ä¸­ã€‚

ç°åœ¨è®©æˆ‘ä»¬åœ¨ demo ä¸­æ·»åŠ ä¸€ä¸ª `flip_image()` å‡½æ•°å¹¶æ·»åŠ ä¸€ä¸ªç¿»è½¬å›¾åƒçš„æ–°é€‰é¡¹å¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦æœ‰ 2 ä¸ªé€‰é¡¹å¡çš„ç¤ºä¾‹ï¼Œä¹Ÿä½¿ç”¨äº†ä¸€ä¸ªè¡Œï¼š

```python
import numpy as np
import gradio as gr

demo = gr.Blocks()

def flip_text(x):
    return x[::-1]

def flip_image(x):
    return np.fliplr(x)

with demo:
    gr.Markdown("Flip text or image files using this demo.")
    with gr.Tabs():
        with gr.TabItem("Flip Text"):
            with gr.Row():
                text_input = gr.Textbox()
                text_output = gr.Textbox()
            text_button = gr.Button("Flip")
        with gr.TabItem("Flip Image"):
            with gr.Row():
                image_input = gr.Image()
                image_output = gr.Image()
            image_button = gr.Button("Flip")

    text_button.click(flip_text, inputs=text_input, outputs=text_output)
    image_button.click(flip_image, inputs=image_input, outputs=image_output)

demo.launch()
```


ä½ ä¼šæ³¨æ„åˆ°ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜åœ¨æ¯ä¸ªé€‰é¡¹å¡ä¸­åˆ›å»ºäº†ä¸€ä¸ª `Button` ç»„ä»¶ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ºæ¯ä¸ªæŒ‰é’®åˆ†é…äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œè¿™æ˜¯å®é™…è¿è¡Œè¯¥å‡½æ•°çš„äº‹ä»¶ã€‚

#### æ¢ç´¢äº‹ä»¶å’ŒçŠ¶æ€ 

æ­£å¦‚ä½ å¯ä»¥æ§åˆ¶å¸ƒå±€ä¸€æ ·ï¼Œ `å—` å¯ä»¥è®©ä½ å¯¹è§¦å‘å‡½æ•°è°ƒç”¨çš„äº‹ä»¶è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚æ¯ä¸ªç»„ä»¶å’Œè®¸å¤šå¸ƒå±€éƒ½æœ‰å®ƒä»¬æ”¯æŒçš„ç‰¹å®šäº‹ä»¶ã€‚

ä¾‹å¦‚ï¼Œ `Textbox` ç»„ä»¶æœ‰ä¸¤ä¸ªäº‹ä»¶ï¼š `change()` ï¼ˆå½“æ–‡æœ¬æ¡†å†…çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼‰ï¼Œå’Œ `submit()` ï¼ˆå½“ç”¨æˆ·åœ¨å…³æ³¨æ–‡æœ¬æ¡†æ—¶æŒ‰ä¸‹ enter é”®ï¼‰ã€‚æ›´å¤æ‚çš„ç»„ä»¶å¯ä»¥æœ‰æ›´å¤šçš„äº‹ä»¶ï¼šä¾‹å¦‚ï¼Œ `Audio` ç»„ä»¶ä¹Ÿæœ‰å•ç‹¬çš„äº‹ä»¶ï¼Œç”¨äºæ’­æ”¾ã€æ¸…é™¤ã€æš‚åœéŸ³é¢‘æ–‡ä»¶ç­‰ã€‚è¯·å‚é˜…æ–‡æ¡£äº†è§£æ¯ä¸ªç»„ä»¶æ”¯æŒçš„äº‹ä»¶ã€‚

ä½ å¯ä»¥å°†äº‹ä»¶è§¦å‘å™¨é™„åŠ åˆ°è¿™äº›äº‹ä»¶ä¸­çš„ä¸€ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ç»„ä»¶å®ä¾‹ä¸­è°ƒç”¨äº‹ä»¶åç§°ä½œä¸ºå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨ -- ä¾‹å¦‚ `textbox.change(...)` æˆ– `btn.click(...)` ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

- `fn` ï¼šè¦è¿è¡Œçš„å‡½æ•°
- `inputs` ï¼šç»„ä»¶çš„ï¼ˆåˆ—è¡¨ï¼‰ï¼Œå…¶å€¼åº”ä½œä¸ºå‡½æ•°çš„è¾“å…¥å‚æ•°æä¾›ã€‚æ¯ä¸ªç»„ä»¶çš„å€¼æŒ‰é¡ºåºæ˜ å°„åˆ°ç›¸åº”çš„å‡½æ•°å‚æ•°ã€‚å¦‚æœå‡½æ•°ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œåˆ™æ­¤å‚æ•°å¯ä»¥ä¸º Noneã€‚
- `outputs` ï¼šåº”æ ¹æ®å‡½æ•°è¿”å›çš„å€¼æ›´æ–°å…¶å€¼çš„ç»„ä»¶ï¼ˆåˆ—è¡¨ï¼‰ã€‚æ¯ä¸ªè¿”å›å€¼æŒ‰é¡ºåºè®¾ç½®ç›¸åº”ç»„ä»¶çš„å€¼ã€‚å¦‚æœå‡½æ•°ä¸è¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™æ­¤å‚æ•°å¯ä»¥ä¸º Noneã€‚

ä½ ç”šè‡³å¯ä»¥ä½¿è¾“å…¥å’Œè¾“å‡ºç»„ä»¶æˆä¸ºåŒä¸€ä¸ªç»„ä»¶ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™ä¸ªä½¿ç”¨ GPT æ¨¡å‹è¿›è¡Œæ–‡æœ¬è¡¥å…¨çš„ç¤ºä¾‹ä¸­æ‰€åšçš„é‚£æ ·ï¼š

```python
import gradio as gr

api = gr.Interface.load("huggingface/EleutherAI/gpt-j-6B")

def complete_with_gpt(text):
    # Use the last 50 characters of the text as context
    return text[:-50] + api(text[-50:])

with gr.Blocks() as demo:
    textbox = gr.Textbox(placeholder="Type here and press enter...", lines=4)
    btn = gr.Button("Generate")

    btn.click(complete_with_gpt, textbox, textbox)

demo.launch()
```

#### åˆ›å»ºå¤šæ­¥ demo 

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ª ï¼¿å¤šæ­¥éª¤çš„ demoï¼¿, å…¶ä¸­é‡ç”¨ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ã€‚ä½¿ç”¨ `å—` å¾ˆå®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä½ å¯ä»¥ä½¿ç”¨ç»„ä»¶ä½œä¸ºä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨çš„è¾“å…¥ï¼Œä½†ä½œä¸ºå¦ä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨çš„è¾“å‡ºã€‚çœ‹çœ‹ä¸‹é¢ç¤ºä¾‹ä¸­çš„æ–‡æœ¬ç»„ä»¶ï¼Œå®ƒçš„å€¼æ˜¯è¯­éŸ³åˆ°æ–‡æœ¬æ¨¡å‹çš„ç»“æœï¼Œä½†ä¹Ÿè¢«ä¼ é€’åˆ°æƒ…æ„Ÿåˆ†ææ¨¡å‹ï¼š

```python
from transformers import pipeline

import gradio as gr

asr = pipeline("automatic-speech-recognition", "facebook/wav2vec2-base-960h")
classifier = pipeline("text-classification")

def speech_to_text(speech):
    text = asr(speech)["text"]
    return text

def text_to_sentiment(text):
    return classifier(text)[0]["label"]

demo = gr.Blocks()

with demo:
    audio_file = gr.Audio(type="filepath")
    text = gr.Textbox()
    label = gr.Label()

    b1 = gr.Button("Recognize Speech")
    b2 = gr.Button("Classify Sentiment")

    b1.click(speech_to_text, inputs=audio_file, outputs=text)
    b2.click(text_to_sentiment, inputs=text, outputs=label)

demo.launch()
```

#### æ›´æ–°ç»„ä»¶å±æ€§ 

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•åˆ›å»ºäº‹ä»¶æ¥æ›´æ–°å¦ä¸€ä¸ªç»„ä»¶çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³æ›´æ”¹ç»„ä»¶çš„å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚æ–‡æœ¬æ¡†çš„å¯è§æ€§æˆ–å•é€‰æŒ‰é’®ç»„ä¸­çš„é€‰é¡¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä½ å¯ä»¥é€šè¿‡è¿”å›ç»„ä»¶ç±»çš„ `update()` æ–¹æ³•è€Œä¸æ˜¯å‡½æ•°çš„å¸¸è§„è¿”å›å€¼æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

è¿™å¾ˆå®¹æ˜“ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š

```python
import gradio as gr

def change_textbox(choice):
    if choice == "short":
        return gr.Textbox.update(lines=2, visible=True)
    elif choice == "long":
        return gr.Textbox.update(lines=8, visible=True)
    else:
        return gr.Textbox.update(visible=False)

with gr.Blocks() as block:
    radio = gr.Radio(
        ["short", "long", "none"], label="What kind of essay would you like to write?"
    )
    text = gr.Textbox(lines=2, interactive=True)

    radio.change(fn=change_textbox, inputs=radio, outputs=text)
    block.launch()
```

æˆ‘ä»¬åˆšåˆšæ¢ç´¢äº† `å—` çš„æ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µï¼å°±åƒ `å‚æ•°ä¸€æ ·` ï¼Œä½ å¯ä»¥åˆ›å»ºå¾ˆé…·çš„ demoï¼Œå¯ä»¥é€šè¿‡åœ¨ `launch()` æ–¹æ³•ä¸­ä½¿ç”¨ `share=True` æ¥å…±äº«ï¼Œæˆ–è€…éƒ¨ç½²åœ¨ [Hugging Face Spaces](https://huggingface.co/spaces)(https://huggingface.co/spaces) ä¸Šã€‚