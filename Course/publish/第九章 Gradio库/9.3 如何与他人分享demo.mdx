## 9.3 å¦‚ä½•ä¸ä»–äººåˆ†äº«demoï¼Ÿ 

ç°åœ¨ä½ å·²ç»æ„å»ºäº†ä¸€ä¸ªdemoï¼Œä½ å¯èƒ½å¸Œæœ›ä¸å…¶ä»–äººåˆ†äº«å®ƒã€‚æ¢¯åº¦demoå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å…±äº«ï¼šä½¿ç”¨ ***temporary share link*** æˆ– ***permanent hosting on Spaces***ã€‚

æˆ‘ä»¬å°†å¾ˆå¿«ä»‹ç»è¿™ä¸¤ç§æ–¹æ³•ã€‚ä½†åœ¨åˆ†äº«demoä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦å®Œå–„å®ƒ ğŸ’…ã€‚

#### æ‰“ç£¨ä½ çš„ Gradio demoï¼š

![Overview of a gradio interface](https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter9/gradio-demo-overview.png "Overview of a gradio interface")

ä¸ºäº†ç»™ä½ çš„demoæ·»åŠ é¢å¤–çš„å†…å®¹ï¼Œ `Interface` ç±»æ”¯æŒä¸€äº›å¯é€‰å‚æ•°ï¼š
    - `title` ï¼šä½ å¯ä»¥ç»™ä½ çš„demoä¸€ä¸ªæ ‡é¢˜ï¼Œå®ƒå‡ºç°åœ¨è¾“å…¥å’Œè¾“å‡ºç»„ä»¶çš„ä¸Šæ–¹ã€‚
    - `description` ï¼šä½ å¯ä»¥ä¸ºç•Œé¢æä¾›æè¿°ï¼ˆæ–‡æœ¬ã€Markdown æˆ– HTMLï¼‰ï¼Œæ˜¾ç¤ºåœ¨è¾“å…¥å’Œè¾“å‡ºç»„ä»¶çš„ä¸Šæ–¹å’Œæ ‡é¢˜ä¸‹æ–¹ã€‚
    - `article` ï¼šä½ è¿˜å¯ä»¥ç¼–å†™æ‰©å±•æ–‡ç« ï¼ˆæ–‡æœ¬ã€Markdown æˆ– HTMLï¼‰æ¥è§£é‡Šç•Œé¢ã€‚å¦‚æœæä¾›ï¼Œå®ƒä¼šå‡ºç°åœ¨è¾“å…¥å’Œè¾“å‡ºç»„ä»¶çš„_ä¸‹æ–¹ã€‚
    - `theme` ï¼šä¸å–œæ¬¢é»˜è®¤é¢œè‰²ï¼Ÿå°†ä¸»é¢˜è®¾ç½®ä¸ºä½¿ç”¨ `default` ã€ `huggingface` ã€ `grass` ã€ `peach` ä¹‹ä¸€ã€‚ä½ è¿˜å¯ä»¥æ·»åŠ  `dark-` å‰ç¼€ï¼Œä¾‹å¦‚ `dark-peach` ç”¨äºæ·±è‰²ä¸»é¢˜ï¼ˆæˆ–è€…åªæ˜¯ `dark` ç”¨äºé»˜è®¤çš„æ·±è‰²ä¸»é¢˜ï¼‰ã€‚
    - `examples` ï¼šä¸ºäº†è®©ä½ çš„demo `æ›´æ˜“äºä½¿ç”¨` ï¼Œä½ å¯ä»¥ä¸ºå‡½æ•°æä¾›ä¸€äº›ç¤ºä¾‹è¾“å…¥ã€‚å®ƒä»¬å‡ºç°åœ¨ UI ç»„ä»¶ä¸‹æ–¹ï¼Œå¯ç”¨äºå¡«å……ç•Œé¢ã€‚è¿™äº›åº”è¯¥ä½œä¸ºåµŒå¥—åˆ—è¡¨æä¾›ï¼Œå…¶ä¸­å¤–éƒ¨åˆ—è¡¨â€‹â€‹ç”±æ ·æœ¬ç»„æˆï¼Œæ¯ä¸ªå†…éƒ¨åˆ—è¡¨å¯¹åº”äºæ¯ä¸ªè¾“å…¥ç»„ä»¶çš„è¾“å…¥ç»„æˆã€‚
    - `live` ï¼šå¦‚æœä½ æƒ³è®©ä½ çš„demoâ€œæ´»â€ï¼Œè¿™æ„å‘³ç€ä½ çš„æ¨¡å‹æ¯æ¬¡è¾“å…¥æ›´æ”¹æ—¶éƒ½ä¼šé‡æ–°è¿è¡Œï¼Œä½ å¯ä»¥è®¾ç½® `live=True` ã€‚è¿™å¯¹ä½¿ç”¨å¿«é€Ÿæ¨¡å‹å¾ˆæœ‰æ„ä¹‰ï¼ˆæˆ‘ä»¬å°†åœ¨æœ¬èŠ‚æœ«å°¾çœ‹åˆ°ä¸€ä¸ªç¤ºä¾‹ï¼‰
ä½¿ç”¨ä¸Šé¢çš„é€‰é¡¹ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ªæ›´å®Œæ•´çš„ç•Œé¢ã€‚è¿è¡Œä¸‹é¢çš„ä»£ç ï¼Œä»¥ä¾¿ä¸ Rick and Morty èŠå¤©ï¼š

```python
title = "Ask Rick a Question"
description = """
The bot was trained to answer questions based on Rick and Morty dialogues. Ask Rick anything!
<img src="https://huggingface.co/spaces/course-demos/Rick_and_Morty_QA/resolve/main/rick.png" width=200px>
"""

article = "Check out [the original Rick and Morty Bot](https://huggingface.co/spaces/kingabzpro/Rick_and_Morty_Bot)(https://huggingface.co/spaces/kingabzpro/Rick_and_Morty_Bot) that this demo is based off of."

gr.Interface(
    fn=predict,
    inputs="textbox",
    outputs="text",
    title=title,
    description=description,
    article=article,
    examples=[["What are you doing?"], ["Where should we time travel to?"]],
).launch()
```

ä½¿ç”¨ä¸Šé¢çš„é€‰é¡¹ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ªæ›´å®Œæ•´çš„ç•Œé¢ã€‚è¯•è¯•ä¸‹é¢çš„ç•Œé¢ï¼š

#### ä½¿ç”¨ä¸´æ—¶é“¾æ¥åˆ†äº«ä½ çš„demo 
ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æœºå™¨å­¦ä¹ æ¨¡å‹çš„å·¥ä½œdemoï¼Œè®©æˆ‘ä»¬å­¦ä¹ å¦‚ä½•è½»æ¾å…±äº«æŒ‡å‘æˆ‘ä»¬ç•Œé¢çš„é“¾æ¥ã€‚
é€šè¿‡åœ¨ `launch()` æ–¹æ³•ä¸­è®¾ç½® `share=True` å¯ä»¥è½»æ¾åœ°å…¬å¼€å…±äº«æ¥å£ï¼š

```python
gr.Interface(classify_image, "image", "label").launch(share=True)
```

è¿™ä¼šç”Ÿæˆä¸€ä¸ªå…¬å¼€çš„ã€å¯å…±äº«çš„é“¾æ¥ï¼Œä½ å¯ä»¥å°†å…¶å‘é€ç»™ä»»ä½•äººï¼å½“ä½ å‘é€æ­¤é“¾æ¥æ—¶ï¼Œå¦ä¸€æ–¹çš„ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¯•ç”¨è¯¥æ¨¡å‹é•¿è¾¾ 72 å°æ—¶ã€‚å› ä¸ºå¤„ç†å‘ç”Ÿåœ¨ä½ çš„è®¾å¤‡ä¸Šï¼ˆåªè¦ä½ çš„è®¾å¤‡ä¿æŒå¼€å¯ï¼ï¼‰ï¼Œä½ ä¸å¿…æ‹…å¿ƒæ‰“åŒ…ä»»ä½•ä¾èµ–é¡¹ã€‚å¦‚æœä½ ä½¿ç”¨ Google Colab ç¬”è®°æœ¬å·¥ä½œï¼Œåˆ™å§‹ç»ˆä¼šè‡ªåŠ¨åˆ›å»ºå…±äº«é“¾æ¥ã€‚å®ƒé€šå¸¸çœ‹èµ·æ¥åƒè¿™æ ·ï¼š**XXXXX.gradio.app**ã€‚è™½ç„¶é“¾æ¥æ˜¯é€šè¿‡ Gradio é“¾æ¥æä¾›çš„ï¼Œä½†æˆ‘ä»¬åªæ˜¯ä½ æœ¬åœ°æœåŠ¡å™¨çš„ä»£ç†ï¼Œä¸ä¼šå­˜å‚¨é€šè¿‡æ¥å£å‘é€çš„ä»»ä½•æ•°æ®ã€‚

ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™äº›é“¾æ¥æ˜¯å¯å…¬å¼€è®¿é—®çš„ï¼Œè¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ä½ çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼å› æ­¤ï¼Œè¯·ç¡®ä¿ä¸è¦é€šè¿‡ä½ ç¼–å†™çš„å‡½æ•°å…¬å¼€ä»»ä½•æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–å…è®¸åœ¨ä½ çš„è®¾å¤‡ä¸Šå‘ç”Ÿä»»ä½•å…³é”®æ›´æ”¹ã€‚å¦‚æœè®¾ç½® `share=False` ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™ä»…åˆ›å»ºæœ¬åœ°é“¾æ¥ã€‚

#### åœ¨ Hugging Face Spaces ä¸Šæ‰˜ç®¡ä½ çš„demo 

å¯ä»¥ä¼ é€’ç»™åŒäº‹çš„å…±äº«é“¾æ¥å¾ˆé…·ï¼Œä½†æ˜¯å¦‚ä½•æ°¸ä¹…æ‰˜ç®¡ä½ çš„demoå¹¶è®©å®ƒå­˜åœ¨äºäº’è”ç½‘ä¸Šè‡ªå·±çš„â€œç©ºé—´â€ä¸­ï¼Ÿ

Hugging Face Spaces æä¾›äº†åœ¨äº’è”ç½‘ä¸Šæ°¸ä¹…æ‰˜ç®¡ Gradio æ¨¡å‹çš„åŸºç¡€è®¾æ–½ï¼Œ**å…è´¹**ï¼Spaces å…è®¸ä½ åˆ›å»ºå¹¶æ¨é€åˆ°ï¼ˆå…¬å…±æˆ–ç§äººï¼‰å­˜å‚¨åº“ï¼Œ
ä½ çš„ Gradio åœ¨å“ªé‡Œ
æ¥å£ä»£ç å°†å­˜åœ¨äº `app.py` æ–‡ä»¶ä¸­ã€‚ [é˜…è¯»åˆ†æ­¥æ•™ç¨‹](https://huggingface.co/blog/gradio-spaces)(https://huggingface.co/blog/gradio-spaces) å¼€å§‹ä½¿ç”¨ï¼Œæˆ–è§‚çœ‹ä¸‹é¢çš„ç¤ºä¾‹è§†é¢‘ã€‚

### âœï¸ è®©æˆ‘ä»¬åº”ç”¨å®ƒï¼

ä½¿ç”¨åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åœ¨å„èŠ‚ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬åœ¨æœ¬ç« ç¬¬ä¸€èŠ‚ä¸­çœ‹åˆ°çš„è‰å›¾è¯†åˆ«demoã€‚è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ç•Œé¢æ·»åŠ ä¸€äº›è‡ªå®šä¹‰å¹¶è®¾ç½® `share=True` ä»¥åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ä¼ é€’çš„å…¬å…±é“¾æ¥ã€‚

æˆ‘ä»¬å¯ä»¥ä» [class_names.txt](https://huggingface.co/spaces/dawood/Sketch-Recognition/blob/main/class_names.txt)(https://huggingface.co/spaces/dawood/Sketch-Recognition/blob/main/class_names.txt) åŠ è½½æ ‡ç­¾ï¼Œå¹¶ä» [pytorch_model.bin](https://huggingface.co/spaces/dawood/Sketch-Recognition/blob/main/pytorch_model.bin)(https://huggingface.co/spaces/dawood/Sketch-Recognition/blob/main/pytorch_model.bin) åŠ è½½é¢„è®­ç»ƒçš„ pytorch æ¨¡å‹ é€šè¿‡ç‚¹å‡»é“¾æ¥å¹¶å•å‡»æ–‡ä»¶é¢„è§ˆå·¦ä¸Šè§’çš„ä¸‹è½½æ¥ä¸‹è½½è¿™äº›æ–‡ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œçœ‹çœ‹æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è¿™äº›æ–‡ä»¶æ¥åŠ è½½æˆ‘ä»¬çš„æ¨¡å‹å¹¶åˆ›å»ºä¸€ä¸ª `predict()` å‡½æ•°ï¼š
```python
from pathlib import Path
import torch
import gradio as gr
from torch import nn

LABELS = Path("class_names.txt").read_text().splitlines()

model = nn.Sequential(
    nn.Conv2d(1, 32, 3, padding="same"),
    nn.ReLU(),
    nn.MaxPool2d(2),
    nn.Conv2d(32, 64, 3, padding="same"),
    nn.ReLU(),
    nn.MaxPool2d(2),
    nn.Conv2d(64, 128, 3, padding="same"),
    nn.ReLU(),
    nn.MaxPool2d(2),
    nn.Flatten(),
    nn.Linear(1152, 256),
    nn.ReLU(),
    nn.Linear(256, len(LABELS)),
)
state_dict = torch.load("pytorch_model.bin", map_location="cpu")
model.load_state_dict(state_dict, strict=False)
model.eval()

def predict(im):
    x = torch.tensor(im, dtype=torch.float32).unsqueeze(0).unsqueeze(0) / 255.0
    with torch.no_grad():
        out = model(x)
    probabilities = torch.nn.functional.softmax(out[0], dim=0)
    values, indices = torch.topk(probabilities, 5)
    return {LABELS[i]: v.item() for i, v in zip(indices, values)}
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª `predict()` å‡½æ•°ã€‚ä¸‹ä¸€æ­¥æ˜¯å®šä¹‰å¹¶å¯åŠ¨æˆ‘ä»¬çš„æ¸å˜ç•Œé¢ï¼š

```python
interface = gr.Interface(
    predict,
    inputs="sketchpad",
    outputs="label",
    theme="huggingface",
    title="Sketch Recognition",
    description="Who wants to play Pictionary? Draw a common object like a shovel or a laptop, and the algorithm will guess in real time!",
    article="<p style='text-align: center'>Sketch Recognition | Demo Model</p>",
    live=True,
)
interface.launch(share=True)
```


æ³¨æ„ `Interface` ä¸­çš„ `live=True` å‚æ•°ï¼Œè¿™æ„å‘³ç€è‰å›¾demoä½¿
æ¯æ¬¡æœ‰äººåœ¨ç”»æ¿ä¸Šç”»ç”»æ—¶çš„é¢„æµ‹ï¼ˆæ²¡æœ‰æäº¤æŒ‰é’®ï¼ï¼‰ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ `launch()` æ–¹æ³•ä¸­è®¾ç½®äº† `share=True` å‚æ•°ã€‚
è¿™å°†åˆ›å»ºä¸€ä¸ªå…¬å…±é“¾æ¥ï¼Œä½ å¯ä»¥å‘é€ç»™ä»»ä½•äººï¼å½“ä½ å‘é€æ­¤é“¾æ¥æ—¶ï¼Œå¯¹æ–¹çš„ç”¨æˆ·å¯ä»¥å°è¯•è‰å›¾è¯†åˆ«æ¨¡å‹ã€‚é‡ç”³ä¸€ä¸‹ï¼Œä½ è¿˜å¯ä»¥åœ¨ Hugging Face Spaces ä¸Šæ‰˜ç®¡æ¨¡å‹ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬èƒ½å¤ŸåµŒå…¥ä¸Šé¢çš„demoçš„æ–¹å¼ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç» Gradio å¯ç”¨äº Hugging Face ç”Ÿæ€ç³»ç»Ÿçš„å…¶ä»–æ–¹å¼ï¼